<!DOCTYPE html>
<html lang="en">
<head>
    <title>listbox</title>
</head>
<style>
   .week-listRM [aria-selected="true"] {
    background-color: #ffffff;
    color: #000000;
    font-weight: bold;
    border: 0.5px solid #000000; 
  }
  .roving-tabindex {
    margin: auto;
    width: 45%;
    border: 3px solid #73AD21;
    padding: 20px;
    float: left;
  }
</style>
<body>
    <div class="roving-tabindex">
        <h2>Listbox roving tabindex example</h2>
      
        <span id="daysRM">Week Days roving tabindex</span>
      
        <div role="listboxRM" aria-labelledby="daysRM">
          <br>
          <div class="week-listRM" aria-labelledby="daysRM">
            <div role="option" aria-selected="true" tabindex="0">Sunday</div>
            <div role="option" aria-selected="false" tabindex="-1">Monday</div>
            <div role="option" aria-selected="false" tabindex="-1">Tuesday</div>
            <div role="option" aria-selected="false" tabindex="-1">Wednesday</div>
            <div role="option" aria-selected="false" tabindex="-1">Thursday</div>
            <div role="option" aria-selected="false" tabindex="-1">Friday</div>
            <div role="option" aria-selected="false" tabindex="-1">Saturday</div>
          </div>
        </div>
      </div>
<script>
let selectedOptions = document.querySelector(".week-listRM");

selectedOptions.addEventListener('keydown', e => {
    let targetRM = e.target;
    let key = e.key;
  

  if (key === "ArrowUp" || key === "ArrowDown") {
    event.preventDefault();
    navigateListbox(key);
  } else if (key === " ") {
    event.preventDefault();
    toggleOptionSelection(targetRM);
  }
})

function navigateListbox(key) {
    let options = document.querySelectorAll('[role="option"]');
    let currentIndexRM = Array.prototype.indexOf.call(options, document.activeElement);

  if (key === "ArrowUp" && currentIndexRM > 0) {
    options[currentIndexRM].tabIndex = -1;
    options[currentIndexRM - 1].tabIndex = 0;
    options[currentIndexRM - 1].focus();
  } else if (key === "ArrowDown" && currentIndexRM < options.length - 1) {
    options[currentIndexRM].tabIndex = -1;
    options[currentIndexRM + 1].tabIndex = 0;
    options[currentIndexRM + 1].focus();
  }
}

function toggleOptionSelection(option) {
    let isSelectedRM = option.getAttribute("aria-selected") === "true";

  if (isSelectedRM) {
    option.setAttribute("aria-selected", "false");
    option.classList.remove("selected");
    selectedOptions.splice(selectedOptions.indexOf(option), 1);
  } else {
    option.setAttribute("aria-selected", "true");
    option.classList.add("selected");
    selectedOptions.push(option);
  }
}
  selectedOptions.addEventListener('click', e =>{
    let targetHRM = event.target;

    if (targetHRM.getAttribute("role") === "option") {
      toggleOptionSelection(targetHRM);
    }
  })

</script>
</body>
</html>
else if (key === "ArrowDown" && currentIndexRM < options.length - 1) {
    options[currentIndexRM].tabIndex = -1;
    options[currentIndexRM + 1].tabIndex = 0;
    options[currentIndexRM + 1].focus();

    currentIndexRM[currentIndexM + 1].focus();
    
    if (key === "ArrowUp" && currentIndexRM > 0) {
        // options[currentIndexRM].tabIndex = -1;
        // options[currentIndexRM - 1].tabIndex = 0;
        options[currentIndexRM - 1].focus();
      } else if (key === "ArrowDown" && currentIndexRM < options.length - 1) {
        // options[currentIndexRM].tabIndex = -1;
        // options[currentIndexRM + 1].tabIndex = 0;
        options[currentIndexRM + 1].focus();
      }